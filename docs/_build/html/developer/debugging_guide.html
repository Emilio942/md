<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Debugging Guide &#8212; ProteinMD 1.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script src="../_static/documentation_options.js?v=8d563738"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Git Workflow" href="git_workflow.html" />
    <link rel="prev" title="Performance Guide" href="performance_guide.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="debugging-guide">
<h1>Debugging Guide<a class="headerlink" href="#debugging-guide" title="Link to this heading">¶</a></h1>
<p>This guide provides comprehensive debugging strategies and tools for ProteinMD development. Effective debugging is crucial for maintaining code quality and resolving complex simulation issues.</p>
<nav class="contents local" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#general-debugging-principles" id="id1">General Debugging Principles</a></p>
<ul>
<li><p><a class="reference internal" href="#systematic-approach" id="id2">Systematic Approach</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#common-debugging-scenarios" id="id3">Common Debugging Scenarios</a></p>
<ul>
<li><p><a class="reference internal" href="#simulation-accuracy-issues" id="id4">Simulation Accuracy Issues</a></p></li>
<li><p><a class="reference internal" href="#performance-debugging" id="id5">Performance Debugging</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#debugging-tools" id="id6">Debugging Tools</a></p>
<ul>
<li><p><a class="reference internal" href="#python-debugger-pdb" id="id7">Python Debugger (pdb)</a></p></li>
<li><p><a class="reference internal" href="#ide-debugging" id="id8">IDE Debugging</a></p></li>
<li><p><a class="reference internal" href="#logging-for-debugging" id="id9">Logging for Debugging</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gpu-debugging" id="id10">GPU Debugging</a></p>
<ul>
<li><p><a class="reference internal" href="#cuda-debugging" id="id11">CUDA Debugging</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-and-validation" id="id12">Testing and Validation</a></p>
<ul>
<li><p><a class="reference internal" href="#assertion-based-debugging" id="id13">Assertion-Based Debugging</a></p></li>
<li><p><a class="reference internal" href="#unit-test-debugging" id="id14">Unit Test Debugging</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#common-issues-and-solutions" id="id15">Common Issues and Solutions</a></p>
<ul>
<li><p><a class="reference internal" href="#numerical-instabilities" id="id16">Numerical Instabilities</a></p></li>
<li><p><a class="reference internal" href="#memory-leaks" id="id17">Memory Leaks</a></p></li>
<li><p><a class="reference internal" href="#performance-regressions" id="id18">Performance Regressions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#best-practices" id="id19">Best Practices</a></p>
<ul>
<li><p><a class="reference internal" href="#debugging-workflow" id="id20">Debugging Workflow</a></p></li>
<li><p><a class="reference internal" href="#debugging-checklist" id="id21">Debugging Checklist</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tools-and-resources" id="id22">Tools and Resources</a></p>
<ul>
<li><p><a class="reference internal" href="#essential-tools" id="id23">Essential Tools</a></p></li>
<li><p><a class="reference internal" href="#external-resources" id="id24">External Resources</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="general-debugging-principles">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">General Debugging Principles</a><a class="headerlink" href="#general-debugging-principles" title="Link to this heading">¶</a></h2>
<section id="systematic-approach">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Systematic Approach</a><a class="headerlink" href="#systematic-approach" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Reproduce the Issue</strong>
- Create minimal test cases
- Document exact conditions
- Verify consistency across environments</p></li>
<li><p><strong>Isolate the Problem</strong>
- Use binary search to narrow down code sections
- Test individual components separately
- Check input data validity</p></li>
<li><p><strong>Gather Information</strong>
- Collect relevant logs and error messages
- Document system configuration
- Note timing and sequence of events</p></li>
<li><p><strong>Form Hypotheses</strong>
- Based on symptoms and code knowledge
- Test one hypothesis at a time
- Document findings</p></li>
</ol>
</section>
</section>
<section id="common-debugging-scenarios">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Common Debugging Scenarios</a><a class="headerlink" href="#common-debugging-scenarios" title="Link to this heading">¶</a></h2>
<section id="simulation-accuracy-issues">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Simulation Accuracy Issues</a><a class="headerlink" href="#simulation-accuracy-issues" title="Link to this heading">¶</a></h3>
<p><strong>Energy Conservation Problems</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Debug energy drift</span>
<span class="k">def</span><span class="w"> </span><span class="nf">debug_energy_conservation</span><span class="p">(</span><span class="n">simulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Debug energy conservation in MD simulation.&quot;&quot;&quot;</span>
    <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_total_energy</span><span class="p">()</span>
            <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

            <span class="c1"># Check for sudden energy jumps</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">energies</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># Threshold</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Large energy change at step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">delta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">simulation</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;debug_step_</span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">.pdb&quot;</span><span class="p">)</span>

    <span class="c1"># Plot energy vs time</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">energies</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ps)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Energy (kcal/mol)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy Conservation Check&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;energy_debug.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Force Calculation Validation</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">validate_forces</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate forces using numerical differentiation.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

    <span class="n">positions</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
    <span class="n">analytical_forces</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">get_forces</span><span class="p">()</span>

    <span class="n">numerical_forces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">1e-8</span>  <span class="c1"># Small displacement</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="c1"># Forward difference</span>
            <span class="n">pos_plus</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pos_plus</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">h</span>
            <span class="n">system</span><span class="o">.</span><span class="n">set_positions</span><span class="p">(</span><span class="n">pos_plus</span><span class="p">)</span>
            <span class="n">energy_plus</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>

            <span class="c1"># Backward difference</span>
            <span class="n">pos_minus</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pos_minus</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">h</span>
            <span class="n">system</span><span class="o">.</span><span class="n">set_positions</span><span class="p">(</span><span class="n">pos_minus</span><span class="p">)</span>
            <span class="n">energy_minus</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>

            <span class="c1"># Numerical force</span>
            <span class="n">numerical_forces</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">energy_plus</span> <span class="o">-</span> <span class="n">energy_minus</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>

    <span class="c1"># Restore original positions</span>
    <span class="n">system</span><span class="o">.</span><span class="n">set_positions</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

    <span class="c1"># Compare forces</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">analytical_forces</span> <span class="o">-</span> <span class="n">numerical_forces</span><span class="p">)</span>
    <span class="n">max_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">max_diff</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Force validation failed: max difference = </span><span class="si">{</span><span class="n">max_diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="performance-debugging">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Performance Debugging</a><a class="headerlink" href="#performance-debugging" title="Link to this heading">¶</a></h3>
<p><strong>Profiling Slow Code</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cProfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pstats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pstats</span><span class="w"> </span><span class="kn">import</span> <span class="n">SortKey</span>

<span class="k">def</span><span class="w"> </span><span class="nf">profile_simulation</span><span class="p">(</span><span class="n">simulation_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Profile a simulation function.&quot;&quot;&quot;</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">cProfile</span><span class="o">.</span><span class="n">Profile</span><span class="p">()</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">simulation_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">pr</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">sortby</span> <span class="o">=</span> <span class="n">SortKey</span><span class="o">.</span><span class="n">CUMULATIVE</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">pstats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="n">sortby</span><span class="p">)</span>
    <span class="n">ps</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p><strong>Memory Usage Tracking</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tracemalloc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="k">def</span><span class="w"> </span><span class="nf">monitor_memory_usage</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor memory usage during function execution.&quot;&quot;&quot;</span>
    <span class="c1"># Start tracing</span>
    <span class="n">tracemalloc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>

    <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># MB</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial memory: </span><span class="si">{</span><span class="n">initial_memory</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Get memory statistics</span>
        <span class="n">current</span><span class="p">,</span> <span class="n">peak</span> <span class="o">=</span> <span class="n">tracemalloc</span><span class="o">.</span><span class="n">get_traced_memory</span><span class="p">()</span>
        <span class="n">final_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># MB</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final memory: </span><span class="si">{</span><span class="n">final_memory</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory increase: </span><span class="si">{</span><span class="n">final_memory</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">initial_memory</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Peak traced memory: </span><span class="si">{</span><span class="n">peak</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

        <span class="n">tracemalloc</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</section>
</section>
<section id="debugging-tools">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Debugging Tools</a><a class="headerlink" href="#debugging-tools" title="Link to this heading">¶</a></h2>
<section id="python-debugger-pdb">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Python Debugger (pdb)</a><a class="headerlink" href="#python-debugger-pdb" title="Link to this heading">¶</a></h3>
<p><strong>Basic Usage</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pdb</span>

<span class="k">def</span><span class="w"> </span><span class="nf">problematic_function</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># Set breakpoint</span>
    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>

    <span class="c1"># Your code here</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p><strong>Advanced pdb Commands</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Navigation
n          # Next line
s          # Step into function
c          # Continue execution
l          # List current code

# Inspection
p variable # Print variable
pp variable # Pretty print
args       # Show function arguments

# Stack
w          # Show stack trace
u          # Move up stack frame
d          # Move down stack frame

# Execution
!statement # Execute Python statement
exit       # Exit debugger
</pre></div>
</div>
</section>
<section id="ide-debugging">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">IDE Debugging</a><a class="headerlink" href="#ide-debugging" title="Link to this heading">¶</a></h3>
<p><strong>VS Code Configuration</strong></p>
<p>Create <cite>.vscode/launch.json</cite>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.2.0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;configurations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Debug Tests&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pytest&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tests/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-v&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;console&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integratedTerminal&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;cwd&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workspaceFolder}&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Debug Simulation&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;request&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;launch&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;program&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${workspaceFolder}/examples/run_simulation.py&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;console&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;integratedTerminal&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--debug&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="logging-for-debugging">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Logging for Debugging</a><a class="headerlink" href="#logging-for-debugging" title="Link to this heading">¶</a></h3>
<p><strong>Structured Logging</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="k">def</span><span class="w"> </span><span class="nf">setup_debug_logging</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up comprehensive debug logging.&quot;&quot;&quot;</span>
    <span class="c1"># Create logger</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;proteinmd&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="c1"># Create handlers</span>
    <span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s1">&#39;debug.log&#39;</span><span class="p">)</span>

    <span class="c1"># Create formatters</span>
    <span class="n">detailed_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
        <span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(filename)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
    <span class="p">)</span>
    <span class="n">console_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
        <span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Set formatters</span>
    <span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">console_formatter</span><span class="p">)</span>
    <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">detailed_formatter</span><span class="p">)</span>

    <span class="c1"># Add handlers</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>
</pre></div>
</div>
<p><strong>Context-Aware Logging</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">debug_context</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide debugging context for operations.&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;proteinmd&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entering </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully completed </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">raise</span>
</pre></div>
</div>
</section>
</section>
<section id="gpu-debugging">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">GPU Debugging</a><a class="headerlink" href="#gpu-debugging" title="Link to this heading">¶</a></h2>
<section id="cuda-debugging">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">CUDA Debugging</a><a class="headerlink" href="#cuda-debugging" title="Link to this heading">¶</a></h3>
<p><strong>Memory Debugging</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cupy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>

<span class="k">def</span><span class="w"> </span><span class="nf">debug_gpu_memory</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Debug GPU memory usage.&quot;&quot;&quot;</span>
    <span class="n">mempool</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_default_memory_pool</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Used bytes: </span><span class="si">{</span><span class="n">mempool</span><span class="o">.</span><span class="n">used_bytes</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total bytes: </span><span class="si">{</span><span class="n">mempool</span><span class="o">.</span><span class="n">total_bytes</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get detailed memory info</span>
    <span class="k">with</span> <span class="n">cp</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">free_bytes</span><span class="p">,</span> <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">memGetInfo</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GPU free memory: </span><span class="si">{</span><span class="n">free_bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GPU total memory: </span><span class="si">{</span><span class="n">total_bytes</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Kernel Debugging</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable CUDA debugging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CUDA_LAUNCH_BLOCKING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">debug_cuda_kernel</span><span class="p">(</span><span class="n">kernel_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Debug CUDA kernel execution.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">kernel_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">Stream</span><span class="o">.</span><span class="n">null</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>  <span class="c1"># Ensure completion</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="n">cp</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">CUDARuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CUDA error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Print device information</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">Device</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compute capability: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">compute_capability</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</pre></div>
</div>
</section>
</section>
<section id="testing-and-validation">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Testing and Validation</a><a class="headerlink" href="#testing-and-validation" title="Link to this heading">¶</a></h2>
<section id="assertion-based-debugging">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Assertion-Based Debugging</a><a class="headerlink" href="#assertion-based-debugging" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">validate_simulation_state</span><span class="p">(</span><span class="n">simulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate simulation state with assertions.&quot;&quot;&quot;</span>
    <span class="c1"># Check basic invariants</span>
    <span class="k">assert</span> <span class="n">simulation</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;No atoms in simulation&quot;</span>
    <span class="k">assert</span> <span class="n">simulation</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Negative time: </span><span class="si">{</span><span class="n">simulation</span><span class="o">.</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Check physical constraints</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">positions</span><span class="p">)),</span> <span class="s2">&quot;NaN positions detected&quot;</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">positions</span><span class="p">)),</span> <span class="s2">&quot;Infinite positions detected&quot;</span>

    <span class="n">velocities</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_velocities</span><span class="p">()</span>
    <span class="n">max_velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">velocities</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">max_velocity</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unrealistic velocity: </span><span class="si">{</span><span class="n">max_velocity</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Check energy reasonableness</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_total_energy</span><span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">energy</span><span class="p">),</span> <span class="s2">&quot;NaN energy detected&quot;</span>
    <span class="k">assert</span> <span class="n">energy</span> <span class="o">&lt;</span> <span class="mf">1e6</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unreasonably high energy: </span><span class="si">{</span><span class="n">energy</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
<section id="unit-test-debugging">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Unit Test Debugging</a><a class="headerlink" href="#unit-test-debugging" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_with_debug_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of debugging-friendly test.&quot;&quot;&quot;</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">create_test_simulation</span><span class="p">()</span>

    <span class="c1"># Capture initial state</span>
    <span class="n">initial_energy</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_total_energy</span><span class="p">()</span>
    <span class="n">initial_positions</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Run simulation</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Debug information on failure</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_positions</span><span class="p">(),</span> <span class="n">expected_positions</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial energy: </span><span class="si">{</span><span class="n">initial_energy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final energy: </span><span class="si">{</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_total_energy</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position drift: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expected_positions</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Save debug files</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">save_trajectory</span><span class="p">(</span><span class="s1">&#39;debug_trajectory.dcd&#39;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_positions</span><span class="p">(),</span> <span class="n">expected_positions</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="common-issues-and-solutions">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Common Issues and Solutions</a><a class="headerlink" href="#common-issues-and-solutions" title="Link to this heading">¶</a></h2>
<section id="numerical-instabilities">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Numerical Instabilities</a><a class="headerlink" href="#numerical-instabilities" title="Link to this heading">¶</a></h3>
<p><strong>Symptoms:</strong>
- NaN or infinite values
- Energy explosions
- Unrealistic atomic positions</p>
<p><strong>Solutions:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">handle_numerical_instability</span><span class="p">(</span><span class="n">simulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle and recover from numerical instabilities.&quot;&quot;&quot;</span>
    <span class="c1"># Check for problems</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">positions</span><span class="p">))</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numerical instability detected!&quot;</span><span class="p">)</span>

        <span class="c1"># Try recovery strategies</span>
        <span class="k">if</span> <span class="n">simulation</span><span class="o">.</span><span class="n">has_checkpoint</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Restoring from checkpoint...&quot;</span><span class="p">)</span>
            <span class="n">simulation</span><span class="o">.</span><span class="n">restore_checkpoint</span><span class="p">()</span>
            <span class="n">simulation</span><span class="o">.</span><span class="n">timestep</span> <span class="o">*=</span> <span class="mf">0.5</span>  <span class="c1"># Reduce timestep</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced timestep to </span><span class="si">{</span><span class="n">simulation</span><span class="o">.</span><span class="n">timestep</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No checkpoint available, minimizing energy...&quot;</span><span class="p">)</span>
            <span class="n">simulation</span><span class="o">.</span><span class="n">minimize_energy</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="memory-leaks">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Memory Leaks</a><a class="headerlink" href="#memory-leaks" title="Link to this heading">¶</a></h3>
<p><strong>Detection:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">detect_memory_leak</span><span class="p">(</span><span class="n">test_function</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect memory leaks in repeated function calls.&quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

    <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
    <span class="n">initial_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="n">test_function</span><span class="p">()</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>  <span class="c1"># Force garbage collection</span>

        <span class="n">current_memory</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span>
        <span class="n">memory_increase</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_memory</span> <span class="o">-</span> <span class="n">initial_memory</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># MB</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Memory increase = </span><span class="si">{</span><span class="n">memory_increase</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">memory_increase</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># 100 MB threshold</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Potential memory leak detected!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="performance-regressions">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Performance Regressions</a><a class="headerlink" href="#performance-regressions" title="Link to this heading">¶</a></h3>
<p><strong>Benchmarking for Debugging:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>

<span class="k">def</span><span class="w"> </span><span class="nf">benchmark_function</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Benchmark function performance for debugging.&quot;&quot;&quot;</span>
    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="n">mean_time</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
    <span class="n">std_time</span> <span class="o">=</span> <span class="n">statistics</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Function: </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean time: </span><span class="si">{</span><span class="n">mean_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">std_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min time: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max time: </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Best Practices</a><a class="headerlink" href="#best-practices" title="Link to this heading">¶</a></h2>
<section id="debugging-workflow">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Debugging Workflow</a><a class="headerlink" href="#debugging-workflow" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Start with Simple Cases</strong>
- Test with minimal examples
- Use known-good reference data
- Isolate specific components</p></li>
<li><p><strong>Use Version Control</strong>
- Create debug branches
- Commit frequently during debugging
- Tag working versions</p></li>
<li><p><strong>Document Findings</strong>
- Keep debugging notes
- Share solutions with team
- Update documentation</p></li>
<li><p><strong>Automate Validation</strong>
- Create regression tests
- Add assertions for invariants
- Use continuous integration</p></li>
</ol>
</section>
<section id="debugging-checklist">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Debugging Checklist</a><a class="headerlink" href="#debugging-checklist" title="Link to this heading">¶</a></h3>
<p>Before reporting a bug:</p>
<ul class="simple">
<li><p>[ ] Can you reproduce the issue consistently?</p></li>
<li><p>[ ] Have you tested with different input data?</p></li>
<li><p>[ ] Is the issue present in the latest version?</p></li>
<li><p>[ ] Have you checked for similar issues in the bug tracker?</p></li>
<li><p>[ ] Do you have a minimal example that demonstrates the problem?</p></li>
<li><p>[ ] Have you gathered all relevant error messages and logs?</p></li>
<li><p>[ ] Have you tested on different platforms/environments?</p></li>
</ul>
</section>
</section>
<section id="tools-and-resources">
<h2><a class="toc-backref" href="#id22" role="doc-backlink">Tools and Resources</a><a class="headerlink" href="#tools-and-resources" title="Link to this heading">¶</a></h2>
<section id="essential-tools">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Essential Tools</a><a class="headerlink" href="#essential-tools" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Python Debugger (pdb/ipdb)</strong>
- Built-in debugging capabilities
- Interactive debugging session</p></li>
<li><p><strong>Memory Profilers</strong>
- <code class="docutils literal notranslate"><span class="pre">memory_profiler</span></code> for line-by-line memory usage
- <code class="docutils literal notranslate"><span class="pre">tracemalloc</span></code> for memory allocation tracking</p></li>
<li><p><strong>Performance Profilers</strong>
- <code class="docutils literal notranslate"><span class="pre">cProfile</span></code> for function-level profiling
- <code class="docutils literal notranslate"><span class="pre">line_profiler</span></code> for line-by-line timing</p></li>
<li><p><strong>GPU Tools</strong>
- <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code> for GPU monitoring
- <code class="docutils literal notranslate"><span class="pre">nvprof</span></code> for CUDA profiling
- <code class="docutils literal notranslate"><span class="pre">compute-sanitizer</span></code> for memory checking</p></li>
</ol>
</section>
<section id="external-resources">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">External Resources</a><a class="headerlink" href="#external-resources" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Documentation:</strong> Official Python debugging guide</p></li>
<li><p><strong>Books:</strong> “Effective Python” debugging chapters</p></li>
<li><p><strong>Tools:</strong> PyCharm, VS Code debugging features</p></li>
<li><p><strong>Community:</strong> StackOverflow, Python debugging forums</p></li>
</ul>
<p>Remember: Good debugging skills develop with practice. Start with simple techniques and gradually incorporate more advanced tools as needed.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo" />
    
    <h1 class="logo logo-name">ProteinMD</h1>
    
  </a>
</p>



<p class="blurb">Molecular Dynamics Simulation Library</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=your-username&repo=proteinmd&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/user_manual.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/cli_reference.html">CLI Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/examples.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/core.html">Core Simulation Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/structure.html">Structure Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/forcefield.html">Force Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/environment.html">Environment Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/analysis.html">Analysis Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/sampling.html">Sampling Methods API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/visualization.html">Visualization Tools API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/utils.html">Utilities API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../advanced/performance.html">Performance Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/validation.html">Validation and Quality Assurance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/extending.html">Extending ProteinMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/troubleshooting.html">Troubleshooting Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="developer_guide.html">ProteinMD Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#quick-start-for-developers">Quick Start for Developers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="developer_guide.html#core-documentation">Core Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#development-workflow">Development Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#advanced-topics">Advanced Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#reference">Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#getting-help">Getting Help</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#development-environment">Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#contributing-workflow">Contributing Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#key-development-areas">Key Development Areas</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#best-practices-summary">Best Practices Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to ProteinMD</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding_standards.html">Coding Standards and Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_design.html">API Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_workflow.html">Git Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="pull_request_guide.html">Pull Request Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="review_process.html">Review Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_process.html">Release Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance_guide.html">Performance Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/changelog.html#development-milestones">Development Milestones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/changelog.html#release-notes-details">Release Notes Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/changelog.html#upcoming-releases">Upcoming Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/changelog.html#release-process">Release Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/citation.html">Citation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/citation.html#primary-citation">Primary Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/citation.html#component-specific-citations">Component-Specific Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/citation.html#backend-dependencies">Backend Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/citation.html#version-specific-citations">Version-Specific Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/citation.html#contributing-authors">Contributing Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/citation.html#citation-tools">Citation Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/citation.html#contact-for-citations">Contact for Citations</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/your-username/proteinmd">GitHub</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="developer_guide.html">ProteinMD Developer Guide</a><ul>
      <li>Previous: <a href="performance_guide.html" title="previous chapter">Performance Guide</a></li>
      <li>Next: <a href="git_workflow.html" title="next chapter">Git Workflow</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, ProteinMD Development Team.
      
      |
      <a href="../_sources/developer/debugging_guide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/your-username/proteinmd" class="github">
        <img src="../_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>